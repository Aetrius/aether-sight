FROM golang:1.19-alpine

# Install necessary dependencies for Xvfb
RUN apk add --no-cache xvfb x11vnc xinit xterm

# Set up a working directory
WORKDIR /app

# Copy your Golang code into the container
COPY go.mod ./
COPY go.sum ./
COPY . .

RUN go mod download
RUN go mod vendor
RUN go mod tidy

# Install Xvfb and run your Golang code
RUN go build -o aether-image-capture ./cmd/aetherImageCapture

EXPOSE 8080 8081 443 80

CMD ["sh", "-c", "Xvfb :99 -screen 0 1024x768x16 & export DISPLAY=:99 && ./aether-image-capture"]
